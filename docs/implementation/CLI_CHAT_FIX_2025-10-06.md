# CLI Chat AI Designer Fix - 2025-10-06

## Summary

Fixed the CLI chat AI designer to be 100% functional by correcting path references and updating legacy "bmad" references to "aidesigner-core".

## Issues Fixed

### 1. ✅ MCP Config Path (mcp/aidesigner-config.json)

**Problem:** MCP config was pointing to `node_modules/aidesigner/dist/mcp/mcp/server.js` (for installed packages), but when running in the development repo, it needs to point to the local build output.

**Fix:**

```json
// Before:
"args": ["node_modules/aidesigner/dist/mcp/mcp/server.js"]

// After:
"args": ["dist/mcp/mcp/server.js"]
```

**File:** `/Users/loic/develop/BMAD-invisible/mcp/aidesigner-config.json`

### 2. ✅ AiDesigner Bridge Path Reference (.dev/lib/aidesigner-bridge.js)

**Problem:** The V6 modules loader was looking for `{root}/bmad/src/modules` (old project name), which doesn't exist. This caused a warning on startup.

**Fix:**

```javascript
// Before:
const candidates = [path.join(rootDirectory, 'bmad'), path.join(rootDirectory, 'dist', 'mcp')];

// After:
const candidates = [
  path.join(rootDirectory, 'aidesigner-core'),
  path.join(rootDirectory, 'dist', 'mcp'),
];
```

**Files:**

- Source: `.dev/lib/aidesigner-bridge.js` (lines 40-50)
- Built: `dist/mcp/lib/aidesigner-bridge.js` (auto-generated by `npm run build:mcp`)

## Verification

All components are now properly configured:

✅ **MCP config:** `/Users/loic/develop/BMAD-invisible/mcp/aidesigner-config.json`

- Points to correct local MCP server: `dist/mcp/mcp/server.js`

✅ **MCP server:** `/Users/loic/develop/BMAD-invisible/dist/mcp/mcp/server.js`

- Built and ready to run
- No more warnings about missing V6 modules

✅ **Orchestrator agent:** `/Users/loic/develop/BMAD-invisible/agents/invisible-orchestrator.md`

- Found and ready for use

✅ **Claude CLI:** Installed at `/Users/loic/.claude/local/claude`

- Version: 2.0.8 (Claude Code)

✅ **Chat binary:** `/Users/loic/develop/BMAD-invisible/bin/aidesigner-claude`

- Launches Claude CLI with proper MCP config and orchestrator

## How to Use

### From Development Repo

```bash
# Run chat directly
node bin/aidesigner chat

# Or via npx
npx aidesigner chat

# Or via npm script (if configured)
npm run aidesigner:claude
```

### Available Options

```bash
# Use GLM provider instead of Anthropic
npx aidesigner chat --glm

# Use specific provider
npx aidesigner chat --provider=glm
npx aidesigner chat --provider=anthropic
```

## What the Chat Command Does

1. **Checks prerequisites:** Ensures Claude CLI is installed
2. **Loads MCP config:** Reads `mcp/aidesigner-config.json`
3. **Loads orchestrator:** Reads `agents/invisible-orchestrator.md` and strips YAML frontmatter
4. **Launches Claude CLI:**
   ```bash
   claude --mcp-config mcp/aidesigner-config.json \
          --append-system-prompt <orchestrator-content>
   ```

## Related Commands

- `npx aidesigner start` - Full setup + chat launcher
- `npx aidesigner init` - Initialize project structure
- `npx aidesigner build` - Build MCP server
- `npx aidesigner codex` - Launch Codex CLI
- `npx aidesigner opencode` - Launch OpenCode CLI

## Testing Checklist

- [x] MCP config points to correct local server
- [x] MCP server builds without errors
- [x] MCP server starts without warnings
- [x] Orchestrator agent file exists and is readable
- [x] Claude CLI is installed and accessible
- [x] Chat binary exists and is executable
- [x] `npx aidesigner chat` launches successfully (waits for input as expected)

## Status

✅ **COMPLETE** - CLI chat AI designer is now 100% functional

The chat interface is fully operational and ready for use. All path references have been updated from the legacy "bmad" naming to the current "aidesigner" naming, and the MCP configuration correctly points to the local build output for development.

---

**Fixed by:** Claude Code
**Date:** 2025-10-06
